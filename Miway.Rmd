---
title: "MiWay Transit Access for UTM Students: District-Level Analysis"
author: "Group X"
output: pdf_document
date: "2025-11-13"
---

```{r}
df = read.csv("./Datasets/MiWay_Bus_Stops_-4490514804018385747.csv")
head(df)
```

```{r}
library(dplyr)
library(ggplot2)
# install.packages("dplyr")
# install.packages("ggplot2")
counts <- df %>%
  group_by(District) %>%
  summarise(n = n()) %>%
  arrange(desc(n))
head(counts)
df <- df %>% filter(District != "", District != "UNKNOWN")
```

```{r}
ggplot(counts, aes(x = n, y = reorder(District, n))) +
  geom_col(fill = "darkorange") +
  labs(
    title = "Number of Stops by District",
    x = "Count",
    y = "District"
  ) +
  theme_minimal()

```

```{r}
unique(df$District)
```

```{r}
access_summary <- df %>%
  group_by(District) %>%
  summarise(
    accessible = sum(Accessible),
    total = n(),
    proportion = accessible / total
  ) %>%
  arrange(desc(proportion))


```

```{r}
ggplot(access_summary, aes(x = proportion, y = reorder(District, proportion))) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Proportion of Accessible Stops by District",
    x = "Proportion Accessible",
    y = "District"
  ) +
  theme_minimal()


```
AODA (Accessibility for Ontarians with Disabilities Act) Requirements
```{r}
ggplot(access_summary, aes(x = proportion, y = reorder(District, proportion))) +
  geom_col(fill = "steelblue") +
  geom_text(aes(label = sprintf("%.1f%%", proportion * 100)),
            hjust = -0.1, size = 3) +
  xlim(0, 1.15) +
  theme_minimal()
```

Shelter
```{r}
shelter_summary <- df %>%
  group_by(District) %>%
  summarise(
    shelters = sum(Shelter),
    total = n(),
    proportion_sheltered = shelters / total
  ) %>%
  arrange(desc(proportion_sheltered))
head(shelter_summary)

```

```{r}
ggplot(shelter_summary, aes(x = proportion_sheltered, 
                            y = reorder(District, proportion_sheltered))) +
  geom_col(fill = "#FF9933") +
  labs(
    title = "Proportion of Bus Stops with Shelters by District",
    x = "Proportion Sheltered",
    y = "District"
  ) +
  theme_minimal()

```

```{r}
ggplot(shelter_summary, aes(x = shelters, y = reorder(District, shelters))) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Number of Sheltered Stops by District",
    x = "Sheltered Stops",
    y = "District"
  ) +
  theme_minimal()

```


```{r}
library(dplyr)
library(tidyr)

routes_long <- df %>%
  separate_rows(Routes_Service, sep = "/") %>%
  mutate(Routes_Service = trimws(Routes_Service)) %>%
  filter(Routes_Service != "") 
unique_buses <- unique(routes_long$Routes_Service)
unique_buses
```

```{r}
routes_by_district <- routes_long %>%
  group_by(District) %>%
  summarise(n_routes = n_distinct(Routes_Service)) %>%
  arrange(desc(n_routes))
routes_by_district
```

```{r}
library(ggplot2)

ggplot(routes_by_district, aes(x = n_routes, y = reorder(District, n_routes))) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Number of Distinct MiWay Bus Routes by District",
    x = "Number of Routes",
    y = "District"
  ) +
  theme_minimal()

```

```{r}
utm_routes <- c("1", "44", "101", "110", "126")
unique(df$Routes_Service)
```
```{r}
library(dplyr)
library(tidyr)

routes_long <- df %>%
  separate_rows(Routes_Service, sep = "/") %>%
  mutate(Routes_Service = trimws(Routes_Service))

```

```{r}
utm_long <- routes_long %>%
  filter(Routes_Service %in% utm_routes)

district_utm <- utm_long %>%
  group_by(District) %>%
  summarise(
    utm_stops            = n_distinct(Stop_Number),    # stops with a direct UTM bus
    utm_bus_occurrences  = n(),                        # total appearances of UTM routes
    utm_distinct_routes  = n_distinct(Routes_Service)  # how many of the 5 show up here
  ) %>%
  arrange(desc(utm_stops))
```

```{r}

ggplot(district_utm, aes(x = utm_stops, y = reorder(District, utm_stops))) +
  geom_col(fill = "#2C7BB6") +
  labs(
    title = "Direct UTM Bus Access by District",
    x = "Stops with a Direct UTM Bus",
    y = "District"
  ) +
  theme_minimal()

```

```{r}
# One row per (Stop_Number, District, has_utm)
stop_level <- routes_long %>%
  group_by(Stop_Number, District) %>%
  summarise(
    has_utm = any(Routes_Service %in% utm_routes),
    .groups = "drop"
  )

utm_normalized <- stop_level %>%
  group_by(District) %>%
  summarise(
    total_stops = n(),
    utm_stops   = sum(has_utm),
    utm_rate    = utm_stops / total_stops    # THIS IS normalization
  ) %>%
  arrange(desc(utm_rate))



```

```{r}
ggplot(utm_normalized, aes(
    x = utm_rate,
    y = reorder(District, utm_rate)
)) +
  geom_col(fill = "#2C7BB6") +
  labs(
    title = "Normalized Direct UTM Bus Access by District",
    x = "Proportion of Stops Serving UTM",
    y = "District"
  ) +
  theme_minimal()


```

```{r}
go_df = read.csv("./Datasets/GO_Transit_Stations.csv")
stations = go_df$LANDMARKNAME
stations
```

```{r}
# Tag GO-station stops in the MiWay stops data
df$is_GO_stop <- grepl("GO STATION", df$Stop_Description, ignore.case = TRUE)

# Explode routes into one row per (stop, route)
routes_long <- df %>%
  separate_rows(Routes_Service, sep = "/") %>%
  mutate(Routes_Service = trimws(Routes_Service))

# All route numbers that serve at least one GO station stop
go_routes <- routes_long %>%
  filter(is_GO_stop, Routes_Service != "") %>%   # keep only GO stops + non-empty routes
  pull(Routes_Service) %>%
  unique()

# For each (real) district, how many distinct GO-serving routes & GO-connected stops?
go_by_district <- routes_long %>%
  filter(
    Routes_Service %in% go_routes,              # only routes that touch a GO station
    District != "",                             # drop blank districts
    District != "UNKNOWN"                       # drop UNKNOWN pseudo-district
  ) %>%
  group_by(District) %>%
  summarise(
    distinct_go_routes = n_distinct(Routes_Service),
    total_go_stops     = n_distinct(Stop_Number),
    .groups = "drop"
  ) %>%
  arrange(desc(distinct_go_routes))

```


```{r}
ggplot(go_by_district, aes(
    x = distinct_go_routes,
    y = reorder(District, distinct_go_routes)
)) +
  geom_col(fill = "#2C7BB6") +
  labs(
    title = "MiWay Route Connectivity to GO Stations by District",
    x = "Distinct GO-Serving Bus Routes",
    y = "District"
  ) +
  theme_minimal()

```












